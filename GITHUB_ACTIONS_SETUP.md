# GitHub Actions CI/CD Workflows

This project uses automated GitHub Actions workflows for code quality, testing, and AI-powered PR reviews.

## Workflows

### 1. **AI Code Review** (`ai-code-review.yml`)

Automatically analyzes pull requests using AI-powered code review.

**Trigger:** Pull request opened, synchronize, reopened, or edited

**Features:**

- Strict code quality checks
- Logical validation analysis
- Security vulnerability detection
- Performance pattern recognition
- Branch naming convention validation
- PR documentation checks

**Checks Performed:**

- TypeScript type safety (`any` type detection)
- Console statements in production code
- Hardcoded credentials/API keys
- TODO/FIXME comments
- Error handling patterns
- Promise vs async/await usage
- ESLint score validation (90+ required)
- Test coverage verification

**AI Score Calculation:**

```
Base Score: 100
- Each critical error: -15 points
- Each warning: -5 points
- Each logical issue: -10 points
+ Excellent lint score (â‰¥95): +5 points
+ Comprehensive description (>100 chars): +3 points

Approval Threshold: Score â‰¥85 + Lint â‰¥90 + Tests passing
```

**Output:**
Automated comment on PR with:

- Overall AI score (0-100)
- Critical errors (must fix)
- Warnings (should fix)
- Info messages (passed checks)
- Recommendation (APPROVE/REQUEST CHANGES)

---

### 2. **Build & Test** (`build-test.yml`)

Continuous integration for building and testing the project.

**Trigger:** Push to main branches or pull request

**Test Matrix:**

- Node.js 18.x
- Node.js 20.x

**Steps:**

1. Checkout code
2. Setup Node.js environment
3. Install dependencies
4. Run ESLint
5. Build project
6. Run tests
7. Upload coverage reports

**Coverage:** Sends results to Codecov

---

### 3. **Code Quality Analysis** (`code-quality.yml`)

Comprehensive code quality and security scanning.

**Trigger:** Pull requests with changes in `src/` or workflow files

**Checks:**

1. **TypeScript Strict Mode**

   - Type safety validation
   - No implicit `any` types
   - Null/undefined handling

2. **ESLint Analysis**

   - Code style consistency
   - Naming conventions
   - Unused variables
   - Accessibility rules

3. **Security Scanning**

   - Hardcoded credentials detection
   - Vulnerable patterns (eval, innerHTML)
   - XSS vulnerability checks
   - Dependency vulnerabilities

4. **Code Complexity**
   - Function complexity metrics
   - Cyclomatic complexity analysis
   - Dead code detection

**Output:**
Comment on PR with quality status and detailed report

---

## Installation

### Step 1: Create GitHub Actions Directory

```bash
mkdir -p .github/workflows
```

### Step 2: Add Workflow Files

Copy all `.yml` files to `.github/workflows/` directory:

- `ai-code-review.yml`
- `build-test.yml`
- `code-quality.yml`

### Step 3: Configure Repository

1. Go to **Settings â†’ Actions â†’ General**
2. Enable "Read and write permissions" for workflows
3. Allow workflows to create and approve pull requests

### Step 4: Add Required GitHub Secrets

Optional environment variables in **Settings â†’ Secrets and variables**:

```env
GITHUB_TOKEN=<auto-generated>
NPM_TOKEN=<optional, for private packages>
```

---

## Configuration

### ESLint Configuration

Ensure `.eslintrc.json` exists:

```json
{
  "root": true,
  "ignorePatterns": ["dist", "node_modules"],
  "overrides": [
    {
      "files": ["*.ts"],
      "extends": [
        "eslint:recommended",
        "plugin:@typescript-eslint/recommended",
        "plugin:@angular-eslint/recommended"
      ],
      "rules": {
        "@typescript-eslint/explicit-member-accessibility": ["error"],
        "no-any": "error"
      }
    }
  ]
}
```

### package.json Scripts

Required npm scripts:

```json
{
  "scripts": {
    "lint": "eslint src/**/*.ts",
    "build": "ng build",
    "test": "ng test",
    "test:ci": "ng test --watch=false --browsers=ChromeHeadless --code-coverage"
  }
}
```

---

## Branch Protection Rules

### Recommended Settings

Navigate to **Settings â†’ Branches â†’ Branch protection rules**

**Rule Configuration:**

- âœ… Require a pull request before merging
- âœ… Require status checks to pass:
  - `build-and-test`
  - `code-quality`
  - `ai-code-review`
- âœ… Require branches to be up to date before merging
- âœ… Include administrators in restrictions
- âœ… Restrict who can push to matching branches

---

## PR Requirements for Approval

All of the following must be met:

1. **AI Code Review**

   - Score â‰¥ 85/100
   - No critical errors
   - Recommendation: APPROVE

2. **Build & Test**

   - Build succeeds
   - All tests pass
   - No linting errors

3. **Code Quality**

   - TypeScript strict mode compliance
   - ESLint all checks pass
   - No security issues detected

4. **Manual Review**
   - At least 1 approval from code owner
   - Discussions resolved

---

## Viewing Results

### In Pull Request

Each workflow posts automated comments:

- ðŸ¤– AI Code Review Analysis
- ðŸ“Š Code Quality Report
- âœ… Build & Test Status

### In Actions Tab

View detailed logs:

1. Go to **Actions** tab
2. Select workflow run
3. View job logs and outputs

### Status Checks

Look at PR timeline for status of checks:

- Green âœ… = Passed
- Yellow â³ = Running
- Red âŒ = Failed

---

## Troubleshooting

### Workflow Not Running

**Solution:**

1. Verify `.github/workflows/` directory exists
2. Check workflow file YAML syntax
3. Ensure `.yml` file extension (not `.yaml`)
4. Check repository settings allow actions

### Build Failing

**Common Issues:**

- Missing npm dependencies: Run `npm ci`
- TypeScript errors: Check `npm run build` locally
- Test failures: Run `npm test` locally

**Debug:**

```bash
# Install dependencies locally
npm ci

# Run linting
npm run lint

# Build locally
npm run build

# Run tests
npm run test
```

### AI Review Not Posting

**Check:**

1. Workflow file syntax: `workflow_lint.yml`
2. GitHub token permissions
3. Branch protection rules don't block comments

---

## Customization

### Modify AI Score Thresholds

Edit `ai-code-review.yml` in `calculate-score.js`:

```javascript
const finalScore = Math.max(0, Math.min(100, score));
const shouldApprove = finalScore >= 85 && lintPassed && testPassed;
//                                    â†‘ Change threshold here
```

### Add Custom Checks

In `ai-code-review.yml`, add to `analyze.js`:

```javascript
// Custom check example
if (content.includes('debugger')) {
  issues.push({
    severity: 'error',
    category: 'Debugging',
    file,
    message: 'Remove debugger statements before committing.',
  });
  score -= 10;
}
```

### Modify ESLint Rules

Update `.eslintrc.json` for specific rules

### Skip Workflow for Commit

Add to commit message:

```
[skip ci]
```

---

## GitHub Token Permissions

Required permissions in workflow:

```yaml
permissions:
  pull-requests: write # To comment on PRs
  contents: read # To read code
  checks: write # To create check runs
```

---

## Best Practices

1. **Keep workflows simple**: Each workflow should have one primary purpose
2. **Use caching**: Cache npm dependencies for faster runs
3. **Set timeouts**: Prevent hanging workflows
4. **Test locally first**: Run checks locally before pushing
5. **Monitor costs**: GitHub Actions has free tier limits
6. **Document changes**: Update workflow docs when modifying

---

## License

No license required. Free to use for GitHub projects.

## Support

For issues or questions:

1. Check workflow logs in Actions tab
2. Verify file structure and permissions
3. Test locally with `npm` commands
4. Create issue with workflow logs
